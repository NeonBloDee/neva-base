<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="main.css" />
  </head>
  <body>
    <!-- Canvas for GameView (background rendering) -->
    <canvas
      id="backgroundCanvas"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -10;
        display: none;
        pointer-events: none;
      "
    ></canvas>

    <div class="menuBox" id="menuBox" style="display: none">
      <div class="topSide">
        <div class="titleSide">
          <div class="titleBox">
            <img
              src="https://i.ibb.co/VHFyJN6/NEVA-Logo-Blanc-Plan-de-travail-1.png"
              alt=""
              class="titleimg"
            />
            <h1>
              <span id="boutiqueName"></span>
              <p>BOUTIQUE</p>
            </h1>
          </div>
          <div class="titleLine"></div>
          <h2 class="titleDiscription">
            Information
            <p>Boutique du serveur.</p>
          </h2>
        </div>
        <div class="topRightSide">
          <div class="statusSide">
            <div class="statusBox storecode">
              <div class="statusName">
                <i class="fa-solid fa-store"></i>CODE BOUTIQUE
              </div>
              <span id="storeCode"></span>
            </div>
            <div class="statusBox creditsay">
              <div class="statusName">
                <i class="fa-solid fa-credit-card"></i>COINS
              </div>
              <span id="storeCoins"></span>
            </div>
          </div>
          <!-- <div class="promoBox">
            Vous avez un code promo ?
            <div class="promoButton" onclick="useCodePromo()">Utiliser un code promo</div>
          </div> -->
        </div>
      </div>
      <div class="homePage" style="display: flex" id="homePage">
        <div class="vehicleBox categorystyle" id="vehicleBoxCat">
          <h3 class="categoryTitle">
            VÉHICULES
            <p>CATÉGORIE</p>
          </h3>
          <h4 class="categoryDescription">
            Information
            <p>Découvez nos véhicules achetable.</p>
          </h4>
          <img
            src="./img/vehiclecategory.png"
            alt=""
            class="categoryimg vehiclecategory"
          />
        </div>
        <div class="homePageCenterBox">
          <div class="weaponBox categorystyle" id="weaponBoxCat">
            <h3 class="categoryTitle">
              ARMES
              <p>CATÉGORIE</p>
            </h3>
            <h4 class="categoryDescription" style="width: 13.2292vw">
              Information
              <p>Découvrez nos armes achetable.</p>
            </h4>
            <img
              src="./img/weaponcategory.png"
              alt=""
              class="categoryimg weaponimg"
            />
          </div>
          <div class="casesBox categorystyle" id="casezBoxCat">
            <h3 class="categoryTitle">
              CAISSES
              <p>CATÉGORIE</p>
            </h3>
            <h4 class="categoryDescription" style="width: 13.2292vw">
              Information
              <p>Découvrez nos caisses mystère.</p>
            </h4>
            <img
              src="./img/casecategory.png"
              alt=""
              class="categoryimg casesimg"
            />
          </div>
        </div>
        <div class="homePageRightBox">
          <div class="moneyBox categorystyle" id="moneyBoxCat">
            <h3 class="categoryTitle">
              ARGENT
              <p>CATÉGORIE</p>
            </h3>
            <h4 class="categoryDescription" style="width: 13.2292vw">
              Information
              <p>Découvrez nos offres d'argent.</p>
            </h4>
            <img
              src="./img/moneycategory.png"
              alt=""
              class="categoryimg moneyimg"
            />
          </div>
          <div class="creditBox categorystyle" id="manageBoxCat">
            <h3 class="categoryTitle">
              GESTION
              <p>CATÉGORIE</p>
            </h3>
            <h4 class="categoryDescription" style="width: 13.2292vw">
              Information
              <p>Accéder aux options supplémentaires.</p>
            </h4>
            <img src="./img/credit.png" alt="" class="categoryimg creditimg" />
          </div>
        </div>
      </div>
      <div class="productPage" style="display: none" id="VehiclesCatMenu">
        <div class="productTitleBox" id="closeVehiclesCatMenu">
          <div class="backBox"><i class="fa-solid fa-angles-left"></i></div>
          CATÉGORIE VÉHICULES
        </div>
        <div class="productList" id="vehicleListData"></div>
      </div>
      <div
        class="vehicleViewPage"
        style="display: none"
        id="vehicleViewPage"
      ></div>

      <div class="productPage" style="display: none" id="WeaponsCatMenu">
        <div class="productTitleBox" id="closeWeaponsCatMenu">
          <div class="backBox"><i class="fa-solid fa-angles-left"></i></div>
          CATÉGORIE ARMES
        </div>
        <div class="productList" id="weaponListData"></div>
      </div>

      <div class="productPage" style="display: none" id="MoneyCatMenu">
        <div class="productTitleBox" id="closeMoneyCatMenu">
          <div class="backBox"><i class="fa-solid fa-angles-left"></i></div>
          CATÉGORIE ARGENT
        </div>
        <div class="productList" id="moneyListData"></div>
      </div>

      <div class="productPage" style="display: none" id="CaseCatMenu">
        <div class="productTitleBox" id="closeCaseCatMenu">
          <div class="backBox"><i class="fa-solid fa-angles-left"></i></div>
          CATÉGORIE CAISSES
        </div>
        <div class="productList" id="caseListData"></div>
      </div>

      <div class="caseOpeningPage" style="display: none" id="caseOpeningPage">
        <div class="caseOpeningBox">
          <h4 class="caseOpeningTitle">OUVERTURE CAISSE</h4>
          <div class="casePrizeList" id="caseGains"></div>
          <div class="casePrizeList2" id="caseGains2"></div>
          <img src="./img/caseopening.png" alt="" class="caseOpeningArrow" />
        </div>
      </div>
      <div
        class="productConfirmationPage"
        style="display: none"
        id="productConfirmationPage"
      >
        <div class="productConfirmationBox">
          <h2>
            ACHAT
            <p>
              Êtes-vous sûr de vouloir acheter le produit que vous avez
              sélectionné ?
            </p>
          </h2>
          <div class="productConfirmationButtonBox">
            <div
              class="productConfirmationCancelButton"
              id="productConfirmationCancelButton"
            >
              Annuler
            </div>
            <div
              class="productConfirmationBuyButton"
              id="productConfirmationBuyButton"
            >
              Acheter
            </div>
          </div>
        </div>
      </div>

      <div
        class="productConfirmationPage2"
        style="display: none"
        id="productConfirmationPage2"
      >
        <div class="productConfirmationBox">
          <h2>
            Félicitations
            <p>Félicitations pour le lot que vous avez remporté !</p>
          </h2>
          <div class="productConfirmationButtonBox">
            <div
              class="productConfirmationCancelButton"
              id="productConfirmationCancelButton2"
            >
              <p>Vendre <span id="sellCount"></span> Coins</p>
            </div>
            <div
              class="productConfirmationBuyButton"
              id="productConfirmationBuyButton2"
            >
              Collecter
            </div>
          </div>
        </div>
      </div>
      <div class="promoCodePage" style="display: none" id="promoPage">
        <div class="promoCodeBox">
          <h3 class="promoCodeTitle">
            CODE PROMO
            <p>Veuillez rentrer le code de promotion</p>
          </h3>
          <div class="container">
            <div class="input-container">
              <input
                type="text"
                id="promoValue"
                placeholder="Entrez le code..."
              />
            </div>
          </div>
          <div class="promoCodeButton" onclick="useCodeButtonPromo()">
            Utiliser le code
          </div>
          <div class="exitBox" onclick="closePromoCode()">
            <i class="fa-solid fa-xmark"></i>
          </div>
        </div>
      </div>
      <div class="creditBuyPage" style="display: none" id="manageMenuCat">
        <div class="creditBuyBox">
          <h2 class="creditBuyTitle">
            COINS
            <p>Liste des offres</p>
          </h2>
          <div class="creditList" id="tebexListData"></div>
          <!-- <div class="giveCreditBox">
            <h3 class="giveCreditTitle">
              DONNER DES COINS
              <p>
                Vous pouvez envoyer vos coins à un autre joueur via son code boutique
              </p>
            </h3>
            <div class="giveCreditRightBox">
              <div class="giveCreditInputBox">
                <div class="giveCreditInput">
                  <div class="giveCreditInput-container">
                    <input type="text" id="inputStoreCode" placeholder="Code boutique..." />
                  </div>
                </div>
                <div class="giveCreditInput">
                  <div class="giveCreditInput-container">
                    <input type="text" id="inputAmount" placeholder="Montant..." />
                  </div>
                </div>
              </div>
              <div class="giveCreditButton" onclick="giveCoins()">Donner</div>
            </div>
          </div> -->
          <div class="exitBox" id="closeManage">
            <i class="fa-solid fa-xmark"></i>
          </div>
        </div>
      </div>
      <div class="exitBox" onclick="closeAll()">
        <i class="fa-solid fa-xmark"></i>
      </div>
      <!-- <img src="./img/bgeffect.png" alt="" class="bgeffect" /> -->
    </div>

    <div id="notify" style="display: none"></div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js"></script>

  <!-- Load utk_render script for MainRender API -->
  <script type="module" src="nui://utk_render/script.js"></script>

  <!-- GameView with FiveM MainRender integration -->
  <script>
    console.log("🎮 GameView loading...");

    // GameView implementation using FiveM's MainRender API
    window.GameView = function (canvas) {
      console.log("🏗️ GameView constructor called");
      this.canvas = canvas;
      this.initialized = false;
      this.isRendering = false;

      if (canvas && canvas.style) {
        this.initializeRender();
      }
    };

    // Initialize the rendering
    window.GameView.prototype.initializeRender = function () {
      console.log("🎮 Initializing MainRender...");

      const tryInitialize = () => {
        if (typeof MainRender !== "undefined" && MainRender.renderToTarget) {
          console.log("✅ MainRender found, starting native rendering");
          this.startNativeRender();
          this.initialized = true;
        } else {
          console.log("⚠️ MainRender not ready, retrying in 500ms...");
          setTimeout(tryInitialize, 500);
        }
      };

      tryInitialize();
    };

    // Start native FiveM rendering with proper canvas sizing
    window.GameView.prototype.startNativeRender = function () {
      if (this.isRendering) return;

      console.log("🚀 Starting native render");

      // Set canvas to full screen
      this.canvas.style.position = "fixed";
      this.canvas.style.top = "0";
      this.canvas.style.left = "0";
      this.canvas.style.width = "100vw";
      this.canvas.style.height = "100vh";
      this.canvas.style.zIndex = "-10";
      this.canvas.style.display = "block";
      this.canvas.style.pointerEvents = "none";

      // Set canvas actual dimensions to window size
      this.canvas.width = window.innerWidth;
      this.canvas.height = window.innerHeight;

      try {
        MainRender.renderToTarget(this.canvas);
        this.isRendering = true;
        console.log("✅ Native rendering started");
      } catch (error) {
        console.error("❌ Failed to start rendering:", error);
      }
    };

    // Stop rendering
    window.GameView.prototype.stopRender = function () {
      if (!this.isRendering) return;
      console.log("🛑 Stopping render");

      try {
        if (typeof MainRender !== "undefined" && MainRender.stop) {
          MainRender.stop();
        }
      } catch (error) {
        console.error("⚠️ Error stopping render:", error);
      }

      this.canvas.style.display = "none";
      this.isRendering = false;
    };

    // Resize method
    window.GameView.prototype.resize = function () {
      if (this.canvas && this.isRendering) {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
        console.log("📏 Canvas resized");
      }
    };

    // Destroy method
    window.GameView.prototype.destroy = function () {
      console.log("🗑️ GameView destroyed");
      this.stopRender();
      this.initialized = false;
    };

    // Empty render method for compatibility
    window.GameView.prototype.render = function () {
      // MainRender handles rendering
    };
    console.log("✅ GameView loaded");
  </script>

  <!-- utk_render integration functions -->
  <script>
    // Simulated utk_render functions for backdrop-filter support
    window.startRenderLoop = function () {
      console.log(
        "🎬 utk_render: Starting render loop for backdrop-filter support"
      );

      // Try to use actual utk_render if available
      if (typeof MainRender !== "undefined" && MainRender) {
        console.log("✅ Using real utk_render MainRender");
        return;
      }

      // Fallback: Create simple render loop
      const canvas = document.getElementById("backgroundCanvas");
      if (canvas) {
        const ctx = canvas.getContext("2d");
        if (ctx) {
          // Simple gradient for backdrop-filter to work
          function render() {
            ctx.fillStyle = "rgba(0, 50, 100, 0.1)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            requestAnimationFrame(render);
          }
          render();
          console.log("✅ Fallback render loop started");
        }
      }
    };

    window.stopRenderLoop = function () {
      console.log("⏹️ utk_render: Stopping render loop");
      // If using real utk_render, stop it here
      if (typeof MainRender !== "undefined" && MainRender && MainRender.stop) {
        MainRender.stop();
      }
    };

    console.log("✅ utk_render integration functions loaded");
  </script>

  <script src="main.js"></script>
</html>
